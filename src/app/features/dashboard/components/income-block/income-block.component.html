<div class="bg-white rounded-lg shadow-md p-6 h-full flex flex-col" style="min-height: 480px; max-height: 480px;">
  <h2 class="text-xl font-bold mb-4 text-gray-900">Income</h2>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex items-center justify-center flex-grow">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-header-primary"></div>
  </div>

  <!-- Error State -->
  <div *ngIf="hasError && !isLoading" class="text-red-500 text-sm text-center flex-grow flex items-center justify-center">
    <p>{{ errorMessage }}</p>
  </div>

  <!-- Data Content -->
  <div *ngIf="!isLoading && !hasError" class="flex-grow flex flex-col">
    <!-- Data Table with Fixed Height -->
    <div class="flex flex-col flex-grow">
     <div class="overflow-auto" style="height: 316px; min-height: 316px; max-height: 316px;"> <!--border border-gray-200 rounded-t -->
        <table class="w-full text-sm">
          <thead class="sticky top-0 bg-white z-10">
            <tr class="border-b-2 border-header-primary">
              <th class="text-left px-4 py-3 font-semibold text-gray-800">อาคาร</th>
              <th class="text-right px-4 py-3 font-semibold text-gray-800">รายได้ตามสัญญา</th>
              <th class="text-right px-4 py-3 font-semibold text-gray-800">รายได้รับแล้ว</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of paginatedData; let i = index"
                [class.bg-gray-50]="i % 2 === 0"
                [class.bg-white]="i % 2 !== 0"
                class="border-b border-gray-200">
              <td class="px-4 py-3 text-left text-gray-800">{{ row.buildingCode }}</td>
              <td class="px-4 py-3 text-right text-gray-800">{{ utilities.displayNumber(row.contractAmount) }}</td>
              <td class="px-4 py-3 text-right text-gray-800">{{ utilities.displayNumber(row.receivedAmount) }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Total Row (Between table and pagination) -->
      <div class="  bg-blue-50"> <!--border-x border-b border-gray-200 rounded-b -->
        <div class="flex justify-between items-center px-4 py-3 text-sm font-semibold border-t-2 border-header-primary">
          <div class="text-left text-gray-800">Total</div>
          <div class="flex justify-between" style="width: calc(100% - 100px);">
            <div class="text-right text-gray-800" style="flex: 1;">{{ utilities.displayNumber(totalContractAmount) }}</div>
            <div class="text-right text-gray-800" style="flex: 1;">{{ utilities.displayNumber(totalReceivedAmount) }}</div>
          </div>
        </div>
      </div>

      <!-- Pagination Controls -->
      <div class="flex justify-center items-center gap-2 mt-2 relative">
        <!-- Previous Button -->
        <button
          (click)="previousPage()"
          [disabled]="currentPage === 1"
          class="px-2 py-1 text-sm hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center"
          style="min-width: 32px;">
          &lt;
        </button>

        <!-- Page Range Dropdown -->
        <div class="relative">
          <button
            (click)="togglePageDropdown($event)"
            class="px-3 py-1 rounded text-sm hover:bg-gray-100 transition-colors flex items-center justify-center gap-1"
            style="min-width: 120px;">
            <span class="flex-1 text-center">{{ currentPageRange }} of {{ totalItems }}</span>
            <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>

          <!-- Dropdown Menu -->
          <div
            *ngIf="showPageDropdown"
            (click)="$event.stopPropagation()"
            class="absolute bottom-full mb-1 left-0 bg-white rounded shadow-lg z-20 overflow-auto"
            style="max-height: 200px; min-width: 120px;">
            <button
              *ngFor="let range of cachedPageRanges"
              (click)="onDropdownItemClick(range.page, $event)"
              [class.bg-header-primary]="currentPage === range.page"
              [class.text-white]="currentPage === range.page"
              class="w-full px-3 py-2 text-center text-sm hover:bg-gray-100 transition-colors">
              {{ range.label }}
            </button>
          </div>
        </div>

        <!-- Next Button -->
        <button
          (click)="nextPage()"
          [disabled]="currentPage === totalPages"
          class="px-2 py-1 text-sm hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center"
          style="min-width: 32px;">
          &gt;
        </button>
      </div>
    </div>
  </div>
</div>
