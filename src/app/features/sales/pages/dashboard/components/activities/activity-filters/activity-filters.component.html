<!-- activity-filters.component.html -->

<div class="filters-container">

  <!-- Active Filters Display -->
  <div class="active-filters">
    <span class="filters-label">กรองตาม:</span>
    <span class="filters-text">{{ activeFiltersText() }}</span>

    @if (selectedTypes().length > 0 || selectedStatuses().length > 0) {
      <button class="btn-clear-filters" (click)="clearAllFilters()">
        <i class="pi pi-times"></i>
        <span>ล้างทั้งหมด</span>
      </button>
    }
  </div>

  <!-- Filter Buttons -->
  <div class="filter-buttons">

    <!-- Type Filter Button -->
    <div class="filter-dropdown-wrapper">
      <button
        class="btn-filter"
        [class.active]="selectedTypes().length > 0"
        (click)="toggleTypeDropdown()"
      >
        <i class="pi pi-filter"></i>
        <span>ประเภท</span>
        @if (selectedTypes().length > 0) {
          <span class="filter-badge">{{ selectedTypes().length }}</span>
        }
        <i class="pi" [class.pi-chevron-down]="!showTypeDropdown()" [class.pi-chevron-up]="showTypeDropdown()"></i>
      </button>

      <!-- Type Dropdown -->
      @if (showTypeDropdown()) {
        <div class="filter-dropdown">
          <div class="dropdown-header">
            <span class="dropdown-title">เลือกประเภทกิจกรรม</span>
            <button class="btn-dropdown-close" (click)="closeDropdowns()">
              <i class="pi pi-times"></i>
            </button>
          </div>

          <div class="dropdown-content">
            <!-- Assignment -->
            <div
              class="filter-option"
              [class.selected]="isTypeSelected('assignment')"
              (click)="toggleTypeFilter('assignment')"
            >
              <div class="option-left">
                <i class="pi pi-users option-icon"></i>
                <span class="option-label">Assignment</span>
              </div>
              <div class="option-right">
                <span class="option-count">{{ filterCounts().assignment }}</span>
                @if (isTypeSelected('assignment')) {
                  <i class="pi pi-check option-check"></i>
                }
              </div>
            </div>

            <!-- Personal Task -->
            <div
              class="filter-option"
              [class.selected]="isTypeSelected('personal')"
              (click)="toggleTypeFilter('personal')"
            >
              <div class="option-left">
                <i class="pi pi-user option-icon"></i>
                <span class="option-label">Personal Task</span>
              </div>
              <div class="option-right">
                <span class="option-count">{{ filterCounts().personal }}</span>
                @if (isTypeSelected('personal')) {
                  <i class="pi pi-check option-check"></i>
                }
              </div>
            </div>

            <!-- Assigned By Me -->
            <div
              class="filter-option highlight"
              [class.selected]="isTypeSelected('assigned-by-me')"
              (click)="toggleTypeFilter('assigned-by-me')"
            >
              <div class="option-left">
                <i class="pi pi-send option-icon"></i>
                <span class="option-label">มอบหมายโดยฉัน</span>
              </div>
              <div class="option-right">
                <span class="option-count">{{ filterCounts().assignedByMe }}</span>
                @if (isTypeSelected('assigned-by-me')) {
                  <i class="pi pi-check option-check"></i>
                }
              </div>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Status Filter Button -->
    <div class="filter-dropdown-wrapper">
      <button
        class="btn-filter"
        [class.active]="selectedStatuses().length > 0"
        (click)="toggleStatusDropdown()"
      >
        <i class="pi pi-info-circle"></i>
        <span>สถานะ</span>
        @if (selectedStatuses().length > 0) {
          <span class="filter-badge">{{ selectedStatuses().length }}</span>
        }
        <i class="pi" [class.pi-chevron-down]="!showStatusDropdown()" [class.pi-chevron-up]="showStatusDropdown()"></i>
      </button>

      <!-- Status Dropdown -->
      @if (showStatusDropdown()) {
        <div class="filter-dropdown">
          <div class="dropdown-header">
            <span class="dropdown-title">เลือกสถานะกิจกรรม</span>
            <button class="btn-dropdown-close" (click)="closeDropdowns()">
              <i class="pi pi-times"></i>
            </button>
          </div>

          <div class="dropdown-content">
            <!-- Pending -->
            <div
              class="filter-option"
              [class.selected]="isStatusSelected('pending')"
              (click)="toggleStatusFilter('pending')"
            >
              <div class="option-left">
                <div class="status-dot status-pending"></div>
                <span class="option-label">รอดำเนินการ</span>
              </div>
              <div class="option-right">
                <span class="option-count">{{ filterCounts().pending }}</span>
                @if (isStatusSelected('pending')) {
                  <i class="pi pi-check option-check"></i>
                }
              </div>
            </div>

            <!-- In Progress -->
            <div
              class="filter-option"
              [class.selected]="isStatusSelected('in-progress')"
              (click)="toggleStatusFilter('in-progress')"
            >
              <div class="option-left">
                <div class="status-dot status-in-progress"></div>
                <span class="option-label">กำลังดำเนินการ</span>
              </div>
              <div class="option-right">
                <span class="option-count">{{ filterCounts().inProgress }}</span>
                @if (isStatusSelected('in-progress')) {
                  <i class="pi pi-check option-check"></i>
                }
              </div>
            </div>

            <!-- Finished -->
            <div
              class="filter-option"
              [class.selected]="isStatusSelected('finished')"
              (click)="toggleStatusFilter('finished')"
            >
              <div class="option-left">
                <div class="status-dot status-finished"></div>
                <span class="option-label">เสร็จสิ้น</span>
              </div>
              <div class="option-right">
                <span class="option-count">{{ filterCounts().finished }}</span>
                @if (isStatusSelected('finished')) {
                  <i class="pi pi-check option-check"></i>
                }
              </div>
            </div>

            <!-- Returned -->
            <div
              class="filter-option"
              [class.selected]="isStatusSelected('returned')"
              (click)="toggleStatusFilter('returned')"
            >
              <div class="option-left">
                <div class="status-dot status-returned"></div>
                <span class="option-label">ส่งคืน</span>
              </div>
              <div class="option-right">
                <span class="option-count">{{ filterCounts().returned }}</span>
                @if (isStatusSelected('returned')) {
                  <i class="pi pi-check option-check"></i>
                }
              </div>
            </div>

            <!-- Canceled -->
            <div
              class="filter-option"
              [class.selected]="isStatusSelected('canceled')"
              (click)="toggleStatusFilter('canceled')"
            >
              <div class="option-left">
                <div class="status-dot status-canceled"></div>
                <span class="option-label">ยกเลิก</span>
              </div>
              <div class="option-right">
                <span class="option-count">{{ filterCounts().canceled }}</span>
                @if (isStatusSelected('canceled')) {
                  <i class="pi pi-check option-check"></i>
                }
              </div>
            </div>

            <!-- Overdue -->
            <div
              class="filter-option danger"
              [class.selected]="isStatusSelected('overdue')"
              (click)="toggleStatusFilter('overdue')"
            >
              <div class="option-left">
                <i class="pi pi-exclamation-triangle option-icon danger-icon"></i>
                <span class="option-label">เลยกำหนด</span>
              </div>
              <div class="option-right">
                <span class="option-count danger-count">{{ filterCounts().overdue }}</span>
                @if (isStatusSelected('overdue')) {
                  <i class="pi pi-check option-check"></i>
                }
              </div>
            </div>
          </div>
        </div>
      }
    </div>

  </div>

</div>
